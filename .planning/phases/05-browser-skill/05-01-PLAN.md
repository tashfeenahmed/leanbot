---
phase: 05-browser-skill
plan: 01
type: execute
---

<objective>
Implement browser skill as a wrapper around existing BrowserSession, exposing browser automation operations via the skill interface.

Purpose: Convert existing browser tool to skills-only architecture, enabling agent to browse websites, extract content, and interact with web elements.
Output: Working browser skill with SKILL.md and run.ts that delegates to existing BrowserSession.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase research (critical - defines approach)
@.planning/phases/05-browser-skill/05-RESEARCH.md

# Prior phase summaries (relevant patterns)
@.planning/phases/03-skill-executor/03-01-SUMMARY.md
@.planning/phases/04-web-search-skill/04-01-SUMMARY.md

# Reference implementations
@src/skills/bundled/bash/SKILL.md
@src/skills/bundled/web_search/scripts/run.ts
@src/tools/browser/browser.ts
@src/tools/browser/session.ts
@src/tools/browser/types.ts

**Tech stack available:**
- SkillExecutor class for running skill scripts
- SKILL.md + scripts/ folder pattern
- SKILL_ARGS env var for JSON arguments
- Existing BrowserSession with all browser operations

**Established patterns:**
- Path-based skill execution (skillPath -> SKILL.md -> script)
- YAML frontmatter for scripts mapping
- JSON output format: { success, output, error?, exitCode }
- user-invocable: true for skills users can invoke via slash command

**Constraining decisions:**
- SKILL_ARGS env var for passing arguments as JSON
- 30-second default timeout for script execution
- JSON output from scripts

**Critical from RESEARCH.md:**
- This is a WRAPPER skill - import and use existing `BrowserSession` from `src/tools/browser/session.ts`
- Do NOT reimplement browser automation logic
- Start with core operations: navigate, snapshot, click, type, fill, extract, screenshot, close
- user-invocable: true (users can browse via slash command)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create browser skill folder and SKILL.md</name>
  <files>src/skills/bundled/browser/SKILL.md</files>
  <action>
Create skill directory structure following web_search/bash skill patterns:
1. Create `src/skills/bundled/browser/` directory
2. Create SKILL.md with YAML frontmatter:
   - name: browser
   - description: Browse websites, interact with elements, extract content
   - user-invocable: true (users can browse via slash command)
   - triggers: [browse, web, website, page, scrape, click, navigate]
   - scripts.run: "scripts/run.ts"
   - metadata.openclaw.requires.bins: [] (Playwright is managed internally)
3. Add markdown documentation sections:
   - When to Use (browsing sites, scraping content, form automation)
   - Input Format with SKILL_ARGS JSON structure:
     - operation (string, required): One of navigate, snapshot, click, type, fill, extract, screenshot, close
     - url (string): URL for navigate operation
     - target (string|number): Element ref number, CSS selector, or "text=..." for interactions
     - text (string): Text for type/fill operations
     - fullPage (boolean): For screenshot operation
     - format (string): "text" or "html" for extract operation
   - Output Format (JSON with success, output, error, exitCode)
   - Operations Reference (brief description of each operation)
   - Examples section with sample inputs for common operations

Keep under 300 lines. Reference existing BrowserSession behavior from src/tools/browser/browser.ts for operation semantics.
  </action>
  <verify>ls src/skills/bundled/browser/SKILL.md shows file exists</verify>
  <done>SKILL.md exists with proper frontmatter, operation documentation, and examples</done>
</task>

<task type="auto">
  <name>Task 2: Implement browser skill run.ts wrapping BrowserSession</name>
  <files>src/skills/bundled/browser/scripts/run.ts</files>
  <action>
Create run.ts script that wraps existing BrowserSession:

1. Create `src/skills/bundled/browser/scripts/` directory
2. Create run.ts with these components:

**Types:**
```typescript
interface BrowserArgs {
  operation: string;
  url?: string;
  target?: string | number;
  text?: string;
  fullPage?: boolean;
  format?: 'text' | 'html';
  timeout?: number;
}

interface BrowserResult {
  success: boolean;
  output: string;
  error?: string;
  exitCode: number;
}
```

**Output helper:**
```typescript
function outputResult(result: BrowserResult): never {
  console.log(JSON.stringify(result));
  process.exit(result.exitCode);
}
```

**Argument parsing:**
- Parse SKILL_ARGS env var (error if missing)
- Validate operation is one of: navigate, snapshot, click, type, fill, extract, screenshot, close
- Validate required params per operation (url for navigate, target for click/type/fill, etc.)

**Core implementation:**
- Import BrowserSession from `../../../tools/browser/session.js` (note .js extension for ESM)
- Get singleton instance: `BrowserSession.getInstance({ headless: true })`
- Route operation to appropriate session method:
  - navigate: await session.navigate(url), return URL and title
  - snapshot: await session.snapshot(), format elements as list with refs
  - click: await session.click(target), return confirmation
  - type: await session.type(target, text), return confirmation
  - fill: await session.fill(target, text), return confirmation
  - extract: await session.extractText() or extractHtml() based on format param
  - screenshot: await session.screenshot(fullPage), return base64 data info (not full data)
  - close: await session.close(), BrowserSession.resetInstance(), return confirmation
- Wrap in try/catch, output error JSON on failure

**Key points:**
- Do NOT import playwright directly - use existing BrowserSession
- Do NOT reimplement any browser logic - just route to session methods
- Format snapshot output similar to browser.ts snapshot operation
- For screenshot, return metadata (not full base64) to keep output reasonable
- Handle the async nature properly (top-level await)
  </action>
  <verify>
Run: cd /Users/tashfeen/Documents/Projects/smartbot && SKILL_ARGS='{"operation":"navigate","url":"https://example.com"}' npx tsx src/skills/bundled/browser/scripts/run.ts

Output should be JSON with success: true and navigation confirmation (or error if Playwright not installed/configured)
  </verify>
  <done>Script runs, outputs valid JSON, correctly routes operations to BrowserSession</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `ls src/skills/bundled/browser/` shows SKILL.md and scripts/run.ts
- [ ] SKILL.md has valid YAML frontmatter with name, description, triggers, scripts
- [ ] run.ts imports BrowserSession (not playwright directly)
- [ ] run.ts handles missing SKILL_ARGS with error JSON
- [ ] run.ts validates operation parameter
- [ ] Output format matches skill JSON convention: { success, output, error?, exitCode }
- [ ] No TypeScript errors: `npx tsc --noEmit src/skills/bundled/browser/scripts/run.ts`
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- browser skill follows same structure as web_search/bash skills
- Script delegates to BrowserSession (wrapper pattern)
- Script can be executed via SkillExecutor
</success_criteria>

<output>
After completion, create `.planning/phases/05-browser-skill/05-01-SUMMARY.md`
</output>
