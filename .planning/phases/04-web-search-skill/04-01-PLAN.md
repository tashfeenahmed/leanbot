---
phase: 04-web-search-skill
plan: 01
type: execute
---

<objective>
Implement web search skill using Brave Search API as a skill with SKILL.md and scripts.

Purpose: Convert existing Brave Search tool to skills-only architecture, following established patterns from bash skill.
Output: Working web_search skill that can be executed via SkillExecutor.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (relevant)
@.planning/phases/02-bash-skill/02-01-SUMMARY.md
@.planning/phases/03-skill-executor/03-01-SUMMARY.md

# Reference implementation
@src/tools/search.ts
@src/skills/bundled/bash/SKILL.md
@src/skills/bundled/bash/scripts/run.ts
@src/skills/SkillExecutor.ts

**Tech stack available:**
- SkillExecutor class for running skill scripts
- SKILL.md + scripts/ folder pattern
- SKILL_ARGS env var for passing arguments as JSON
- Existing Brave Search API integration in src/tools/search.ts

**Established patterns:**
- Path-based skill execution (skillPath -> SKILL.md -> script)
- YAML frontmatter for scripts mapping
- JSON output format: { success, output, error?, exitCode }
- Input via SKILL_ARGS environment variable
- Exit code 126 for blocked operations, 124 for timeout

**Constraining decisions:**
- user-invocable: true for search skills (users can invoke directly)
- BRAVE_SEARCH_API_KEY from environment
- Follow bash skill SKILL.md structure for consistency
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create web_search skill folder and SKILL.md</name>
  <files>src/skills/bundled/web_search/SKILL.md</files>
  <action>
Create skill directory structure following bash skill pattern:
1. Create `src/skills/bundled/web_search/` directory
2. Create SKILL.md with YAML frontmatter:
   - name: web_search
   - description: Search the web using Brave Search API
   - user-invocable: true (users can invoke as slash command)
   - triggers: [search, web, google, lookup, find information]
   - scripts.run: "scripts/run.ts"
3. Add markdown documentation:
   - When to Use section (current events, news, documentation, fact-checking)
   - Input Format section with SKILL_ARGS JSON structure:
     - query (string, required): The search query
     - count (number, optional, default 5, max 20): Number of results
     - freshness (string, optional): pd/pw/pm/py for time filtering
   - Output Format section (JSON with success, output, error, exitCode)
   - Examples section with sample inputs
   - Note about BRAVE_SEARCH_API_KEY requirement

Model after bash skill SKILL.md but adapted for search-specific parameters.
  </action>
  <verify>ls src/skills/bundled/web_search/SKILL.md shows file exists</verify>
  <done>SKILL.md exists with proper frontmatter and documentation sections</done>
</task>

<task type="auto">
  <name>Task 2: Implement search execution script</name>
  <files>src/skills/bundled/web_search/scripts/run.ts</files>
  <action>
Create run.ts script that:
1. Parse SKILL_ARGS env var for { query, count?, freshness? }
2. Validate inputs:
   - query is required and non-empty
   - count defaults to 5, max 20
   - freshness must be one of: pd, pw, pm, py (if provided)
3. Get BRAVE_SEARCH_API_KEY from environment
   - If missing, output error JSON and exit 1
4. Build fetch request to Brave Search API:
   - URL: https://api.search.brave.com/res/v1/web/search
   - Query params: q, count, text_decorations=false, search_lang=en, country=us, freshness (if provided)
   - Headers: Accept: application/json, X-Subscription-Token: {apiKey}
5. Handle response:
   - On success: Extract web.results and news.results
   - Format each result as: "N. Title (age)\n   URL\n   Description"
   - Prefix news results with [NEWS]
6. Output JSON to stdout:
   - success: true/false
   - output: formatted search results or error message
   - error: error message if failed
   - exitCode: 0 for success, 1 for error

Reference src/tools/search.ts for exact API handling but simplify:
- No logger (skill scripts run standalone)
- No ToolContext (use SKILL_ARGS and env vars)
- Direct console.log for JSON output

Do NOT use external HTTP libraries - use native fetch() which is available in Node.js 18+.
  </action>
  <verify>
Run: cd /Users/tashfeen/Documents/Projects/smartbot && SKILL_ARGS='{"query":"TypeScript tutorial"}' BRAVE_SEARCH_API_KEY="$BRAVE_SEARCH_API_KEY" npx tsx src/skills/bundled/web_search/scripts/run.ts

Output should be JSON with success: true and search results (or error if no API key configured)
  </verify>
  <done>Script runs and outputs valid JSON with search results or appropriate error</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `ls src/skills/bundled/web_search/` shows SKILL.md and scripts/run.ts
- [ ] SKILL.md has valid YAML frontmatter with name, description, triggers, scripts
- [ ] run.ts handles missing API key gracefully with error JSON
- [ ] run.ts handles missing/empty query with error JSON
- [ ] With valid API key, search returns formatted results
- [ ] Output format matches skill JSON convention: { success, output, error?, exitCode }
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- web_search skill follows same structure as bash skill
- Script can be executed via SkillExecutor
</success_criteria>

<output>
After completion, create `.planning/phases/04-web-search-skill/04-01-SUMMARY.md`
</output>
