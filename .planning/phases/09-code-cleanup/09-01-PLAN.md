---
phase: 09-code-cleanup
plan: 01
type: execute
---

<objective>
Remove tool fallback from Agent, making skills the only execution path.

Purpose: Complete the skills-only architecture by removing the tool fallback code path from the agent loop.
Output: Agent executes skills only, no tool registry dependency.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-agent-loop-refactor/07-03-SUMMARY.md

@src/agent/agent.ts
@src/gateway/gateway.ts

**Prior decisions:**
- Phase 07-03: toolRegistry is optional (nullable), not removed - backward compatibility
- Phase 07-02: Skills execute via SkillExecutor, tool definitions from skills

**Current state:**
- Agent has skill execution (primary) + tool fallback (lines 870-912)
- Agent has toolRegistry property (optional but present)
- Gateway creates toolRegistry and passes to Agent

**Goal:**
Remove tool fallback entirely - skills are the ONLY execution path.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove tool fallback execution path from Agent</name>
  <files>src/agent/agent.ts</files>
  <action>
In executeTools method (around line 817-925):
1. Remove the entire tool fallback block (lines 870-912) that starts with `// Fallback to tool (for backward compatibility during transition)`
2. The skill execution block (lines 826-868) stays - it's the primary path
3. After skill execution, if skill not found, return error immediately (the "Unknown skill" case at line 913-921 stays but becomes the only fallback)
4. Remove the `tool` variable declaration and related logic

The method should:
- Try to execute as skill
- If skill not found, return "Unknown skill" error
- No tool fallback path
  </action>
  <verify>npm run build succeeds, grep -n "toolRegistry?.getTool" src/agent/agent.ts returns nothing</verify>
  <done>Tool fallback code removed from executeTools, only skill execution remains</done>
</task>

<task type="auto">
  <name>Task 2: Remove toolRegistry from Agent class</name>
  <files>src/agent/agent.ts</files>
  <action>
1. Remove `toolRegistry?: ToolRegistry;` from AgentOptions interface (line 28)
2. Remove `private toolRegistry: ToolRegistry | null;` property from Agent class (line 165)
3. Remove `this.toolRegistry = options.toolRegistry || null;` from constructor (line 187)
4. Remove the import of `ToolRegistry, ToolContext` from '../tools/types.js' (line 12)

Keep SkillRegistry, SkillExecutor - these are the primary execution mechanism.
  </action>
  <verify>npm run build succeeds, grep -n "toolRegistry" src/agent/agent.ts returns nothing</verify>
  <done>Agent class has no toolRegistry references, fully skills-only</done>
</task>

<task type="auto">
  <name>Task 3: Update Gateway to stop passing toolRegistry to Agent</name>
  <files>src/gateway/gateway.ts</files>
  <action>
In the Agent constructor call (around line 252-269):
1. Remove `toolRegistry: this.toolRegistry,` from the Agent options object

Keep the toolRegistry creation in Gateway (lines 224-238) - it's still used internally for reminder callbacks and file send. Just don't pass it to Agent.

Also update the getToolRegistry() method (lines 438-443) to indicate it's for internal use only, not for Agent.
  </action>
  <verify>npm run build succeeds, grep -n "toolRegistry:" src/gateway/gateway.ts shows only internal uses, not Agent construction</verify>
  <done>Gateway no longer passes toolRegistry to Agent, Agent is skills-only</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] No "toolRegistry" references in agent.ts
- [ ] Agent executeTools only has skill execution path
- [ ] Gateway still initializes toolRegistry for internal use (reminders, file send)
- [ ] Gateway does NOT pass toolRegistry to Agent
</verification>

<success_criteria>

- Tool fallback removed from Agent
- Agent class has no toolRegistry property
- Gateway doesn't pass toolRegistry to Agent
- Build passes
- Skills-only execution confirmed
</success_criteria>

<output>
After completion, create `.planning/phases/09-code-cleanup/09-01-SUMMARY.md`
</output>
