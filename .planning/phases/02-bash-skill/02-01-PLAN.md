---
phase: 02-bash-skill
plan: 01
type: execute
---

<objective>
Create the bash skill as the first complete skill with scripts folder execution, demonstrating the skills-only architecture pattern.

Purpose: Establish the pattern for all future skills by implementing bash command execution using the SkillExecutor infrastructure from Phase 1.

Output: A complete bash skill folder with SKILL.md and scripts/run.ts that can execute shell commands.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase context:**
@.planning/phases/01-skill-system-foundation/01-01-SUMMARY.md

**Key infrastructure from Phase 1:**
- SkillExecutor class in `src/skills/executor.ts` - runs scripts from skills
- Scripts receive context via env vars: SKILL_NAME, SKILL_DIR, SKILL_ARGS (JSON)
- Supported script types: .ts (npx tsx), .js (node), .sh (bash)
- 30-second default timeout

**Reference implementations:**
@src/skills/bundled/git/SKILL.md - Example bundled skill format
@src/tools/bash.ts - Existing bash tool with execution logic

**Skill location:** Bundled skills go in `src/skills/bundled/`

**Decisions from Phase 1 to follow:**
- Pass script args as JSON in SKILL_ARGS env var
- Use TypeScript (.ts) for scripts (gets run with tsx)
- Skill scripts return results via stdout, errors via stderr
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bash skill folder structure and SKILL.md</name>
  <files>src/skills/bundled/bash/SKILL.md</files>
  <action>
Create the bash skill folder and SKILL.md file:

1. Create directory: `src/skills/bundled/bash/`
2. Create directory: `src/skills/bundled/bash/scripts/`

3. Create `SKILL.md` with:
   - Frontmatter:
     - name: bash
     - description: Execute shell commands in the workspace
     - user-invocable: false (agent uses this, not slash command)
     - triggers: [command, shell, terminal, execute, run, bash]
     - scripts: { run: "scripts/run.ts" }
     - metadata.openclaw.emoji: (terminal emoji)
     - metadata.openclaw.requires.bins: [bash]

   - Content: Instructions for the agent on how to use bash skill
     - When to use (running commands, checking system state, file operations)
     - Input format (command string, optional timeout, optional cwd)
     - Output format (stdout, stderr, exit code)
     - Safety considerations (no interactive commands, avoid destructive operations without confirmation)

Follow the format from `src/skills/bundled/git/SKILL.md` but adapted for bash execution.
  </action>
  <verify>ls -la src/skills/bundled/bash/ shows SKILL.md and scripts/ directory</verify>
  <done>Bash skill folder created with SKILL.md containing frontmatter and instructions</done>
</task>

<task type="auto">
  <name>Task 2: Create bash execution script</name>
  <files>src/skills/bundled/bash/scripts/run.ts</files>
  <action>
Create the TypeScript execution script at `src/skills/bundled/bash/scripts/run.ts`:

1. Script reads args from SKILL_ARGS env var (JSON):
   - `command: string` - Required: The bash command to execute
   - `timeout?: number` - Optional: Timeout in ms (default 60000)
   - `cwd?: string` - Optional: Working directory (default to process.cwd())

2. Execution logic (similar to existing BashTool):
   - Parse SKILL_ARGS from environment
   - Validate command is provided
   - Spawn bash process with `-c` flag
   - Use provided cwd or default
   - Set timeout (default 60s, respect executor's 30s overall timeout)
   - Capture stdout and stderr
   - Truncate output if > 30KB
   - Handle timeout gracefully (SIGTERM, then SIGKILL after 5s)

3. Output format (JSON to stdout):
   ```json
   {
     "success": true/false,
     "output": "stdout content",
     "error": "stderr content or error message",
     "exitCode": 0
   }
   ```

4. Error handling:
   - Missing command: Output error JSON, exit 1
   - Invalid JSON in SKILL_ARGS: Output error JSON, exit 1
   - Command failure: Output result with success=false
   - Timeout: Output result with timeout error message

Reference `src/tools/bash.ts` for the execution pattern but adapt for standalone script that reads from env vars.
  </action>
  <verify>
npx tsc --noEmit passes
Test manually:
```bash
SKILL_ARGS='{"command":"echo hello"}' npx tsx src/skills/bundled/bash/scripts/run.ts
# Should output JSON with success:true and output:"hello\n"
```
  </verify>
  <done>run.ts script created that executes bash commands and returns JSON result</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `src/skills/bundled/bash/SKILL.md` exists with valid frontmatter
- [ ] `src/skills/bundled/bash/scripts/run.ts` exists and compiles
- [ ] Manual test passes: `SKILL_ARGS='{"command":"echo hello"}' npx tsx src/skills/bundled/bash/scripts/run.ts`
- [ ] `npx tsc --noEmit` succeeds
</verification>

<success_criteria>
- Both tasks completed
- Bash skill folder structure matches pattern
- SKILL.md has correct frontmatter and instructions
- run.ts executes commands and returns JSON
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-bash-skill/02-01-SUMMARY.md`
</output>
