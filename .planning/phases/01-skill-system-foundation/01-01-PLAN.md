---
phase: 01-skill-system-foundation
plan: 01
type: execute
---

<objective>
Extend the skill system to support executable scripts, enabling skills to perform actions rather than just return instructions.

Purpose: Transform skills from passive instruction containers to active executable capabilities, laying the groundwork for replacing the tool layer entirely.

Output: Updated skill types, loader that detects scripts folders, and a skill executor that runs scripts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Existing skill system:**
@src/skills/types.ts - Current type definitions
@src/skills/loader.ts - SkillLoader class
@src/skills/registry.ts - SkillRegistry class
@src/skills/parser.ts - Frontmatter parser

**Key architectural constraint from PROJECT.md:**
- Each skill folder contains: `SKILL.md` (description + instructions) + `scripts/` (execution scripts)
- Agent outputs skill name + arguments
- Skill execution runs the appropriate script from `scripts/` folder

**Current state:**
- Skill system exists with SKILL.md + YAML frontmatter
- Loader scans directories, checks gates (bins, env, config, platform)
- Registry provides `generateSkillPrompt()` for agent context
- NO script execution capability exists

**Tech stack:**
- TypeScript, Node.js (ESM)
- child_process for script execution
- Pino logger
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend skill types for scripts support</name>
  <files>src/skills/types.ts</files>
  <action>
Add new fields to support script-based execution:

1. Add to `SkillFrontmatter`:
   - `triggers?: string[]` - Keyword patterns that suggest this skill
   - `scripts?: { [action: string]: string }` - Map of action names to script paths relative to skill folder

2. Add to `Skill`:
   - `scriptsDir?: string` - Absolute path to scripts/ folder if it exists
   - `hasScripts: boolean` - Whether skill has executable scripts

3. Add new interface `SkillExecutionRequest`:
   - `skillName: string`
   - `action?: string` - Optional action name (defaults to 'run' or 'default')
   - `args?: Record<string, unknown>` - Arguments to pass to script
   - `cwd?: string` - Working directory for script execution

4. Add new interface `SkillExecutionResult`:
   - `success: boolean`
   - `output?: string` - stdout from script
   - `error?: string` - stderr or error message
   - `exitCode?: number`

Keep existing interfaces intact. Add new fields as optional to maintain backward compatibility.
  </action>
  <verify>npx tsc --noEmit passes without errors</verify>
  <done>New types added: triggers, scripts mapping, scriptsDir, hasScripts, SkillExecutionRequest, SkillExecutionResult</done>
</task>

<task type="auto">
  <name>Task 2: Update loader to detect scripts folders</name>
  <files>src/skills/loader.ts</files>
  <action>
Modify `loadSkillFile` method to detect and populate scripts folder information:

1. After parsing SKILL.md, check if `scripts/` directory exists in same folder:
   ```typescript
   const skillDir = dirname(path);
   const scriptsDir = join(skillDir, 'scripts');
   const hasScripts = await this.directoryExists(scriptsDir);
   ```

2. Add helper method `directoryExists(path: string): Promise<boolean>` that uses fs/promises access() with constants.R_OK.

3. Populate the new Skill fields:
   - `scriptsDir: hasScripts ? scriptsDir : undefined`
   - `hasScripts: hasScripts`

4. If frontmatter has `scripts` mapping, validate that referenced script files exist. Log warning if script path in frontmatter doesn't exist on disk.

5. Update `Skill` construction in `loadSkillFile` to include new fields.

Do NOT modify the loader's directory scanning logic - keep existing behavior of searching for SKILL.md files.
  </action>
  <verify>
Run: `npx tsc --noEmit` passes
Create test skill with scripts/ folder and verify loader detects it:
```bash
mkdir -p /tmp/test-skill/scripts
echo '---
name: test-skill
description: Test skill with scripts
---
# Test' > /tmp/test-skill/SKILL.md
echo '#!/bin/bash
echo "hello"' > /tmp/test-skill/scripts/run.sh
```
  </verify>
  <done>Loader populates scriptsDir and hasScripts fields when scripts/ folder exists</done>
</task>

<task type="auto">
  <name>Task 3: Create skill executor for running scripts</name>
  <files>src/skills/executor.ts</files>
  <action>
Create new file `src/skills/executor.ts` with SkillExecutor class:

1. Import dependencies: spawn from child_process, path utilities, Logger from pino, types from ./types.js

2. Create `SkillExecutor` class:
   ```typescript
   export class SkillExecutor {
     constructor(private logger?: Logger) {}

     async execute(skill: Skill, request: SkillExecutionRequest): Promise<SkillExecutionResult>
   }
   ```

3. `execute` method logic:
   - Verify skill.hasScripts is true, return error if not
   - Determine script to run:
     - If `request.action` provided, look for `scripts/{action}.ts` or `scripts/{action}.sh`
     - If frontmatter.scripts mapping exists, use that path
     - Default to `scripts/run.ts` or `scripts/run.sh`
   - Verify script file exists, return error with helpful message if not
   - Execute script using spawn:
     - For .ts files: use `npx tsx {script}`
     - For .sh files: use `bash {script}`
     - For .js files: use `node {script}`
   - Pass args as JSON in SKILL_ARGS environment variable
   - Pass skill metadata as SKILL_NAME, SKILL_DIR env vars
   - Use request.cwd or skill directory as working directory
   - Capture stdout/stderr with reasonable timeout (30s default)
   - Return SkillExecutionResult with output, error, exitCode

4. Add helper `resolveScript(skill: Skill, action?: string): string | null` to find script path

5. Export function `createSkillExecutor(logger?: Logger): SkillExecutor`

Security considerations:
- Scripts run in skill's own directory by default
- Args passed as env var, not command line (prevents injection)
- Timeout prevents runaway scripts
  </action>
  <verify>
npx tsc --noEmit passes
Add export to src/skills/index.ts: export * from './executor.js'
  </verify>
  <done>SkillExecutor class created with execute method that runs scripts from skill's scripts/ folder</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` succeeds without errors
- [ ] All new types exported from src/skills/index.ts
- [ ] SkillExecutor class created and exported
- [ ] Loader detects scripts/ folders in skills
</verification>

<success_criteria>
- All 3 tasks completed
- TypeScript compiles without errors
- Skill types extended for scripts support
- Loader populates scriptsDir and hasScripts
- SkillExecutor can run scripts from skills folder
</success_criteria>

<output>
After completion, create `.planning/phases/01-skill-system-foundation/01-01-SUMMARY.md`
</output>
